name: Aurora Release Build
permissions:
  contents: read
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  macos-dist:
    runs-on: macos-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Prepare Scripts
        run: |
          mkdir -p build/scripts
          # Use the script you provided as the post-install trigger
          cp install.sh build/scripts/postinstall
          chmod +x build/scripts/postinstall

      - name: Create Installer Package (.pkg)
        run: |
          # Creates a package that runs your code on completion
          pkgbuild --identifier com.yashb.aurora \
                   --version 4.0.0 \
                   --scripts build/scripts \
                   --nopayload \
                   Aurora-Installer.pkg

      - name: Create DMG
        run: |
          mkdir -p dist
          cp Aurora-Installer.pkg dist/
          hdiutil create -volname "Aurora Shell" -srcfolder dist -ov -format UDZO Aurora-Shell-v4.dmg

      - name: Upload Release Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Aurora-Mac-Installer
          path: Aurora-Shell-v4.dmg
