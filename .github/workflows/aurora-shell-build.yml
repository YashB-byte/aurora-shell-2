name: Build Aurora Release

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  macos-installer:
    runs-on: macos-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Prepare Package Scripts
        run: |
          mkdir -p build/scripts
          # Rename install.sh to 'postinstall' so macOS triggers it automatically
          cp install.sh build/scripts/postinstall
          chmod +x build/scripts/postinstall

      - name: Create macOS Package (.pkg)
        run: |
          # --nopayload means the script IS the installer
          pkgbuild --identifier com.yashb.aurora \
                   --version 2.0 \
                   --scripts build/scripts \
                   --nopayload \
                   Aurora-Installer.pkg

      - name: Create DMG
        run: |
          mkdir -p dist
          cp Aurora-Installer.pkg dist/
          hdiutil create -volname "Aurora Shell Installer" \
                         -srcfolder dist \
                         -ov -format UDZO \
                         Aurora-Shell-Mac.dmg

      - name: Upload Release Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Aurora-Installer
          path: Aurora-Shell-Mac.dmg
